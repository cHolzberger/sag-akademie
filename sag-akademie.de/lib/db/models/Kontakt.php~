<?php

/**
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class Kontakt extends BaseKontakt
{
	public function setUp()
    {
    	parent::setUp();
    	$this->actAs("KontaktTemplate");
		
		$this->actAs('Versionable', array(
		 'versionColumn' => 'version',
		 'className' => '%CLASS%Version',
		 'auditLog' => true
		 )
		);
    }
	
	public function getBuchungen() {
		return Doctrine::getTable("ViewBuchungKontakt")->findByKontakt_id($this->id);
	}
	
	public function getAnsprechpartner() {
		$q=Doctrine_Query::create();
		$q->from('Person person')
		->where("person.ansprechpartner <> 0")
		->andWhere("person.kontakt_id = ?", $this->id);
		
		return $q->execute()->getFirst();
	}

	public function autocompleteTableProxy($firma) {
		$q = Doctrine_Query::create()
		->select ("k.firma, k.ort, k.plz")
		->from("Kontakt k")
		->where("kontakt.firma LIKE ? ", $firma . "%");
		
		return $q;
	}
}
?>