-- Kontakte zur weiteren verarbeitung
/*
CREATE OR REPLACE VIEW view_kontakt_export AS
SELECT
  * ,
  x_taetigkeitsbereich.name AS taetigkeitsbereich,
  x_branche.name AS branche,
  kontakt_kategorie.name AS kategorie,
  x_land.name AS land,
  x_bundesland.name AS bundesland,
  kontakt_quelle.name AS kontaktquellename,
  x_user.vorname AS angelegt_vorname,
  x_user.nachname AS angelegt_nachname
FROM `kontakt`
  LEFT JOIN kontakt_kategorie ON ( kontakt.kontaktkategorie = kontakt_kategorie.id )
  LEFT JOIN x_branche ON ( kontakt.branche_id = x_branche.id )
  LEFT JOIN x_taetigkeitsbereich ON ( kontakt.taetigkeitsbereich_id = x_taetigkeitsbereich.id )
  LEFT JOIN x_land ON ( kontakt.land_id = x_land.id )
  LEFT JOIN x_bundesland ON ( kontakt.bundesland_id = x_bundesland.id )
  LEFT JOIN kontakt_quelle ON ( kontakt.kontakt_quelle = kontakt_quelle.id )
  LEFT JOIN x_user ON ( kontakt.angelegt_user_id = x_user.id );
*/
CREATE OR REPLACE ALGORITHM=UNDEFINED DEFINER=`sag_stable`@`%` SQL SECURITY DEFINER VIEW `view_kontakt_export` AS select `kontakt`.`id` AS `id`,`kontakt`.`firma` AS `firma`,`kontakt`.`alias` AS `alias`,`kontakt`.`strasse` AS `strasse`,`kontakt`.`nr` AS `nr`,`kontakt`.`plz` AS `plz`,`kontakt`.`tel` AS `tel`,`kontakt`.`email` AS `email`,`kontakt`.`email2` AS `email2`,`kontakt`.`fax` AS `fax`,`kontakt`.`url` AS `url`,`kontakt`.`kontaktkategorie` AS `kontaktkategorie`,`kontakt`.`hauptverwaltung` AS `hauptverwaltung`,`kontakt`.`bundesland` AS `bundesland`,`kontakt`.`land` AS `land`,`kontakt`.`branche` AS `branche`,`kontakt`.`vdrk_mitglied` AS `vdrk_mitglied`,`kontakt`.`vdrk_mitglied_nr` AS `vdrk_mitglied_nr`,`kontakt`.`kundenstatus` AS `kundenstatus`,`kontakt`.`kontakt_quelle` AS `kontakt_quelle`,`kontakt`.`kontakt_quelle_stand` AS `kontakt_quelle_stand`,`kontakt`.`newsletter` AS `newsletter`,`kontakt`.`ort` AS `ort`,`kontakt`.`privat` AS `privat`,`kontakt`.`kundennr` AS `kundennr`,`kontakt`.`zusatz` AS `zusatz`,`kontakt`.`blz` AS `blz`,`kontakt`.`kto` AS `kto`,`kontakt`.`bank` AS `bank`,`kontakt`.`zahlart` AS `zahlart`,`kontakt`.`bemerkung` AS `bemerkung`,`kontakt`.`notiz` AS `notiz`,`kontakt`.`angelegt_user_id` AS `angelegt_user_id`,`kontakt`.`mobil` AS `mobil`,`kontakt`.`newsletter_abmeldedatum` AS `newsletter_abmeldedatum`,`kontakt`.`newsletter_anmeldedatum` AS `newsletter_anmeldedatum`,`kontakt`.`land_id` AS `land_id`,`kontakt`.`bundesland_id` AS `bundesland_id`,`kontakt`.`geaendert` AS `geaendert`,`kontakt`.`geaendert_von` AS `geaendert_von`,`kontakt`.`wiedervorlage` AS `wiedervorlage`,`kontakt`.`dwa_mitglied` AS `dwa_mitglied`,`kontakt`.`dwa_mitglied_nr` AS `dwa_mitglied_nr`,`kontakt`.`rsv_mitglied` AS `rsv_mitglied`,`kontakt`.`rsv_mitglied_nr` AS `rsv_mitglied_nr`,`kontakt`.`regierungsbezirk` AS `regierungsbezirk`,`kontakt`.`kreis` AS `kreis`,`kontakt`.`branche_id` AS `branche_id`,`kontakt`.`taetigkeitsbereich_id` AS `taetigkeitsbereich_id`,`kontakt`.`art_id` AS `art_id`,`kontakt`.`angelegt_datum` AS `angelegt_datum`,`kontakt`.`version` AS `version`,`kontakt`.`bereits_in_verteiler` AS `bereits_in_verteiler`,`kontakt`.`vergleich` AS `vergleich`,`kontakt`.`umkreis` AS `umkreis`,`kontakt`.`quelle_id` AS `quelle_id`,`kontakt`.`qualifiziert` AS `qualifiziert`,`kontakt`.`qualifiziert_datum` AS `qualifiziert_datum`,`kontakt`.`qualifiziert_notiz` AS `qualifiziert_notiz`,`kontakt`.`deleted_at` AS `deleted_at`,`kontakt`.`import_ssm` AS `import_ssm`,`kontakt`.`akquise_kontakt_id` AS `akquise_kontakt_id`,`kontakt`.`kontext` AS `kontext`,`person`.`kontakt_id` AS `ansprechpartner_kontakt_id`,`person`.`vorname` AS `ansprechpartner_vorname`,`person`.`name` AS `ansprechpartner_name`,`person`.`strasse` AS `ansprechpartner_strasse`,`person`.`plz` AS `ansprechpartner_plz`,`person`.`grad` AS `ansprechpartner_grad`,`person`.`geburtstag` AS `ansprechpartner_geburtstag`,`person`.`tel` AS `ansprechpartner_tel`,`person`.`email` AS `ansprechpartner_email`,`person`.`fax` AS `ansprechpartner_fax`,`person`.`mobil` AS `ansprechpartner_mobil`,`person`.`funktion` AS `ansprechpartner_funktion`,`person`.`abteilung` AS `ansprechpartner_abteilung`,`person`.`ansprechpartner` AS `ansprechpartner_ansprechpartner`,`person`.`geschaeftsfuehrer` AS `ansprechpartner_geschaeftsfuehrer`,`person`.`newsletter` AS `ansprechpartner_newsletter`,`person`.`ort` AS `ansprechpartner_ort`,`b1`.`name` AS `ansprechpartner_bundesland`,`l1`.`name` AS `ansprechpartner_land`,`person`.`notiz` AS `ansprechpartner_notiz`,`person`.`newsletter_anmeldedatum` AS `ansprechpartner_newsletter_anmeldedatum`,`person`.`newsletter_abmeldedatum` AS `ansprechpartner_newsletter_abmeldedatum`,`person`.`login_name` AS `ansprechpartner_login_name`,`person`.`login_password` AS `ansprechpartner_login_password`,`person`.`aktiv` AS `ansprechpartner_aktiv`,`person`.`gesperrt` AS `ansprechpartner_gesperrt`,`person`.`gesperrt_info` AS `ansprechpartner_gesperrt_info`,`person`.`geaendert` AS `ansprechpartner_geaendert`,`person`.`wiedervorlage` AS `ansprechpartner_wiedervorlage`,`person`.`ausgeschieden` AS `ansprechpartner_ausgeschieden`,`person`.`zusatz` AS `ansprechpartner_zusatz`,`person`.`anrede` AS `ansprechpartner_anrede`,`x_anrede`.`name` AS `ansprechpartner_geschlecht`,`person`.`titel` AS `ansprechpartner_titel`,`x_bundesland`.`name` AS `bundesland_name`,`x_land`.`name` AS `land_name`,`kontakt_kategorie`.`name` AS `kontaktkategorie_name`,`x_branche`.`name` AS `branche_name`,`x_taetigkeitsbereich`.`name` AS `taetigkeitsbereich_name` from (((((((((`kontakt` left join `x_bundesland` on((`kontakt`.`bundesland_id` = `x_bundesland`.`id`))) left join `x_land` on((`kontakt`.`land_id` = `x_land`.`id`))) left join `kontakt_kategorie` on((`kontakt`.`kontaktkategorie` = `kontakt_kategorie`.`id`))) left join `x_branche` on((`kontakt`.`branche_id` = `x_branche`.`id`))) left join `x_taetigkeitsbereich` on((`kontakt`.`taetigkeitsbereich_id` = `x_taetigkeitsbereich`.`id`))) left join `person` on(((`kontakt`.`id` = `person`.`kontakt_id`) and (`person`.`ansprechpartner` = 1)))) left join `x_bundesland` `b1` on((`person`.`bundesland_id` = `b1`.`id`))) left join `x_land` `l1` on((`person`.`land_id` = `l1`.`id`))) left join `x_anrede` on((`person`.`geschlecht` = `x_anrede`.`id`))) group by `kontakt`.`id`;
